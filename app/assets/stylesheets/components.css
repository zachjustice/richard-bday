/* Component classes for complex patterns that need @apply or pseudo-selectors */
/* ONLY use for complex classes or frequently repeated classes */

/* ============================================
   LANDING PAGE COMPONENTS
   ============================================ */

/* Base anchor styling - animated underline on hover */
@layer base {
  a {
    @apply relative transition-colors;
    color: var(--color-ink);
  }
  a:hover {
    color: var(--color-accent-secondary);
  }
  a:not(.btn-primary):not(.btn-secondary):not(.btn-icon)::after {
    content: '';
    @apply absolute left-0 bottom-0 w-0 h-0.5 transition-all duration-300;
    background-color: var(--color-accent-secondary);
  }
  a:not(.btn-primary):not(.btn-secondary):not(.btn-icon):hover::after {
    @apply w-full;
  }
}

/* ============================================
   CUSTOM UTILITY CLASSES
   ============================================ */

@layer utilities {
  /* Text shadow for branding (Blanksies logo) */
  .text-shadow-brand {
    text-shadow: 2px 2px 0px var(--color-accent-tertiary);
  }

  /* Text shadow for large headings */
  .text-shadow-heading {
    text-shadow: 3px 3px 0px var(--color-accent-yellow);
  }

  /* Strong offset box shadow */
  .shadow-strong {
    box-shadow: 4px 4px 0px var(--color-ink);
  }
}

@layer components {
  /* Page background with doodle pattern */
  .bg-page {
    background-color: var(--color-bg-page);
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='%231A1A2E' stroke-width='1' stroke-opacity='0.06'%3E%3Cpath d='M5 5c2-2 4 0 4 2s-2 4-4 4-4-2-4-4 2-4 4-2'/%3E%3Cpath d='M45 15l8 4-8 4'/%3E%3Cpath d='M15 45c0 0 5-3 8 0s5 5 8 3'/%3E%3Cpath d='M35 35l5 5m-5 0l5-5'/%3E%3Ccircle cx='50' cy='50' r='3'/%3E%3Cpath d='M10 25h8'/%3E%3Cpath d='M25 5v8'/%3E%3E%3C/g%3E%3C/svg%3E");
  }

  /* Editor page viewport â€” fills browser height minus navbar */
  .editor-page-viewport {
    @apply flex flex-col overflow-hidden;
    height: calc(100vh - var(--spacing-navbar));
    min-height: 500px;
  }

  @media (min-width: 768px) {
    .editor-page-viewport { min-height: 600px; }
  }

  @media (min-width: 1024px) {
    .editor-page-viewport { min-height: 700px; }
  }

  /* Primary button with offset shadow */
  .btn-primary {
    @apply relative inline-flex items-center justify-center px-8 py-4 text-lg font-bold uppercase tracking-wide;
    @apply rounded-xl cursor-pointer transition-all duration-200;
    @apply text-white;
    background-color: var(--color-accent-primary);
    border: 3px solid var(--color-ink);
    box-shadow: 4px 4px 0px var(--color-ink);
  }

  .btn-primary:hover {
    box-shadow: 6px 6px 0px var(--color-ink);
    transform: translate(-2px, -2px);
  }

  .btn-primary:active {
    box-shadow: 2px 2px 0px var(--color-ink);
    transform: translate(2px, 2px);
  }

  .btn-primary:focus-visible {
    outline: 3px solid var(--color-accent-secondary);
    outline-offset: 3px;
  }

  /* Loading state for buttons */
  .btn-primary.btn-loading,
  .btn-secondary.btn-loading {
    @apply pointer-events-none cursor-not-allowed;
    opacity: 0.7;
    box-shadow: 2px 2px 0px var(--color-ink);
    transform: translate(2px, 2px);
  }

  .btn-spinner {
    @apply inline-flex items-center justify-center mr-2;
    width: 1.25em;
    height: 1.25em;
  }

  .btn-spinner-svg {
    width: 100%;
    height: 100%;
    animation: spinner-wobble 0.8s ease-in-out infinite;
  }

  /* Main content card */
  .card-primary {
    @apply bg-white rounded-3xl p-8 md:p-10;
    border: 3px solid var(--color-ink);
    box-shadow: 8px 8px 0px var(--color-ink);
  }

  /* Subdued card with softer styling */
  .card-subdued {
    @apply bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-8;
    border: 2px solid rgba(26, 26, 46, 0.2);
  }

  /* Hero card - prominent callout sections (QR code, announcements) */
  /* Can place this inside card-primary since box shadow is thinner */
  .card-secondary {
    @apply bg-white rounded-2xl p-6;
    border: 3px solid var(--color-ink);
    box-shadow: 4px 4px 0px var(--color-ink);
  }

  /* Primary badge - used for room codes, player counts, player items */
  .badge-primary {
    @apply inline-flex items-center gap-2 px-4 py-2 rounded-xl font-bold text-lg border-2 border-ink transition-all duration-200;
    box-shadow: 2px 2px 0px var(--color-ink);
  }

  .badge-primary:hover {
    box-shadow: 4px 4px 0px var(--color-ink);
    transform: translate(-2px, -2px);
  }

  .badge-primary:active {
    box-shadow: 1px 1px 0px var(--color-ink);
    transform: translate(1px, 1px);
  }

  /* Step indicator circles */
  .step-indicator {
    @apply w-12 h-12 rounded-full flex items-center justify-center text-xl font-bold;
    border: 3px solid var(--color-ink);
    box-shadow: 3px 3px 0px var(--color-ink);
  }

  /* Primary title with text shadow */
  .title-primary {
    @apply text-5xl md:text-6xl lg:text-7xl font-black tracking-tight;
    color: var(--color-ink);
    text-shadow: 3px 3px 0px var(--color-accent-tertiary);
  }

  /* Doodle decorations with wiggle animation */
  .doodle-decoration {
    @apply opacity-50;
    animation: doodle-wiggle 3s ease-in-out infinite;
  }
}

/* Doodle animation delays */
.doodle-decoration:nth-child(2) { animation-delay: 0.4s; }
.doodle-decoration:nth-child(3) { animation-delay: 0.8s; }
.doodle-decoration:nth-child(4) { animation-delay: 1.2s; }
.doodle-decoration:nth-child(5) { animation-delay: 1.6s; }
.doodle-decoration:nth-child(6) { animation-delay: 2.0s; }
.doodle-decoration:nth-child(7) { animation-delay: 2.4s; }

@keyframes doodle-wiggle {
  0%, 100% { transform: rotate(var(--tw-rotate, 0)) translateX(0); }
  25% { transform: rotate(var(--tw-rotate, 0)) translateX(-2px) rotate(-1deg); }
  75% { transform: rotate(var(--tw-rotate, 0)) translateX(2px) rotate(1deg); }
}

@keyframes spinner-wobble {
  0% { transform: rotate(0deg); }
  25% { transform: rotate(95deg); }
  50% { transform: rotate(180deg); }
  75% { transform: rotate(275deg); }
  100% { transform: rotate(360deg); }
}

@media (prefers-reduced-motion: reduce) {
  .btn-primary:hover,
  .btn-primary:active,
  .badge-primary:hover,
  .badge-primary:active {
    transform: none;
  }
  .doodle-decoration {
    animation: none;
  }
  .btn-spinner-svg {
    animation: spinner-simple 1.2s linear infinite;
  }
  .btn-primary.btn-loading,
  .btn-secondary.btn-loading {
    transform: none;
  }
}

@keyframes spinner-simple {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* ============================================
   END LANDING PAGE COMPONENTS
   ============================================ */

/* Prompt Tooltip Component */
.prompt-tooltip {
  @apply fixed z-tooltip max-w-[400px] pointer-events-none animate-tooltip-fade-in;
}

.prompt-tooltip.hidden {
  @apply opacity-0;
}

.tooltip-loading {
  @apply bg-white border-2 border-gray-200 rounded-lg p-4 shadow-xl text-sm text-gray-500;
}

.tooltip-content {
  @apply bg-white border-2 border-brand-purple rounded-xl shadow-2xl overflow-hidden;
}

/* Used on final results page by StroriesHelper#render_story_with_tooltips method */
.game-prompt-answer {
  @apply cursor-help transition-all font-bold;
  border-bottom: 2px dotted var(--color-brand-purple);
}

.game-prompt-answer:hover {
  @apply text-brand-purple;
  border-bottom-style: solid;
}

/* Form Components */
.form-input {
  @apply w-full px-4 py-4 text-base font-medium rounded-xl outline-none transition-all;
  border: 2px solid rgba(26, 26, 46, 0.2);
}

.form-input:hover {
  @apply bg-white;
  border-color: var(--color-ink);
}

.form-input:focus {
  @apply bg-white ring-4 -translate-y-px;
  border-color: var(--color-accent-secondary);
  --tw-ring-color: rgba(33, 150, 243, 0.1);
}

.form-input::placeholder {
  @apply font-normal;
  color: rgba(26, 26, 46, 0.55);
}

@media (prefers-reduced-motion: reduce) {
  .form-input:focus {
    transform: none;
  }
}

.form-label {
  @apply flex items-center gap-2 text-sm font-semibold uppercase tracking-wide;
  color: var(--color-ink);
}

.form-header {
  @apply text-3xl font-bold mb-2 leading-tight;
  color: var(--color-ink);
  text-shadow: 2px 2px 0px var(--color-accent-tertiary);
}

.form-subheader {
  @apply text-base;
  color: rgba(26, 26, 46, 0.65);
}

/* Alert/Notice Messages */
.alert-message {
  @apply flex items-center gap-3 px-4 py-4 rounded-xl mb-6 text-sm font-medium border-2;
  background: linear-gradient(135deg, rgba(220, 38, 38, 0.1) 0%, rgba(220, 38, 38, 0.15) 100%);
  color: #dc2626;
  border-color: #fee2e2;
}

.notice-message {
  @apply flex items-center gap-3 px-4 py-4 rounded-xl mb-6 text-sm font-medium border-2;
  background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.15) 100%);
  color: #15803d;
  border-color: rgba(34, 197, 94, 0.3);
}

/* Complex Radio Button Pattern (requires sibling selectors) */
.answer-option {
  @apply block cursor-pointer;
}

.answer-radio {
  @apply sr-only;
}

.answer-content {
  @apply relative flex items-center gap-4
         rounded-xl border-[3px] border-ink
         px-5 py-4
         transition-all duration-200 ease-out
         shadow-[4px_4px_0_0_var(--color-ink)];
}

.answer-text {
  @apply text-base font-semibold text-ink leading-snug;
}

.answer-checkmark {
  @apply flex items-center justify-center
         w-8 h-8 aspect-square flex-none
         rounded-full
         border-2 border-ink
         text-sm font-bold
         text-ink-inverted
         bg-white
         transition-all duration-200 ease-out;
}

.answer-option:hover .answer-content {
  box-shadow: 6px 6px 0px var(--color-ink);
  transform: translate(-2px, -2px);
}

.answer-option:active .answer-content {
  box-shadow: 2px 2px 0px var(--color-ink);
  transform: translate(2px, 2px);
}

.answer-radio:checked ~ .answer-content {
  border-color: var(--color-accent-secondary);
  background-color: var(--color-accent-secondary-light);
  box-shadow: 6px 6px 0px var(--color-ink);
  transform: translate(-2px, -2px);
}


.answer-radio:checked ~ .answer-content .answer-checkmark {
  background-color: var(--color-accent-secondary);
  color: var(--color-ink-inverted);
  border-color: var(--color-accent-secondary);
}

.answer-radio:focus-visible ~ .answer-content {
  outline: 3px solid rgba(33, 150, 243, 0.4);
  outline-offset: 3px;
}

/* Ranked Voting Components
   Note: Medal emojis (ðŸ¥‡ðŸ¥ˆðŸ¥‰) are used in ranking UI despite the general "avoid emojis" guideline.
   Exception made because medals are universally recognized symbols for 1st/2nd/3rd place rankings
   and provide immediate visual hierarchy without requiring custom iconography. */
.ranking-slot {
  @apply flex items-center gap-4 p-4 rounded-xl border-2 border-dashed border-ink/20 min-h-[70px] transition-all;
}

.ranking-slot-filled {
  @apply border-0 p-0 bg-transparent;
}

.ranking-slot.drag-over {
  @apply border-accent-secondary bg-accent-secondary/10 border-solid;
}

.ranking-slot .ranking-answer {
  @apply flex-1 min-w-0;
}

.ranking-slot .ranking-answer .answer-text {
  @apply truncate block;
}

.ranking-medal {
  @apply text-3xl flex-none;
}

.ranking-points {
  @apply text-sm font-bold text-ink/60 min-w-[50px] flex-none;
}

.ranking-placeholder {
  @apply flex-1 text-ink/40 italic text-sm;
}

.ranking-answer {
  @apply flex items-center gap-3 p-4 rounded-xl border-2 border-ink cursor-grab transition-all select-none;
  box-shadow: 2px 2px 0 var(--color-ink);
  -webkit-user-drag: element;
  touch-action: none;
}

.ranking-answer.dragging {
  @apply cursor-grabbing;
  opacity: 0.5;
}

.ranking-answer.swapping {
  animation: swap-pulse 150ms ease-in-out;
}

@keyframes swap-pulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

.ranking-answer:active {
  @apply cursor-grabbing;
}

.ranking-answer:focus-visible {
  outline: 3px solid var(--color-accent-secondary);
  outline-offset: 2px;
}

.ranking-answer.keyboard-selected {
  outline: 3px solid var(--color-accent-tertiary);
  outline-offset: 2px;
  background-color: var(--color-accent-tertiary-light, rgba(255, 214, 10, 0.15));
}

.ranking-slot:focus-visible {
  outline: 3px solid var(--color-accent-tertiary);
  outline-offset: 2px;
}

.ranking-handle {
  @apply text-ink/40 select-none flex-none;
}

@media (max-width: 640px) {
  .ranking-answer {
    touch-action: auto;
  }

  .ranking-handle {
    touch-action: none;
    padding: 12px 8px;
    margin: -12px -4px -12px -8px;
    font-size: 1.25rem;
  }
}

.answer-medal {
  @apply text-2xl mr-2 flex-none;
}

/* Wider scrollbar for ranked voting answers - always visible */
.ranking-answers-scrollable {
  overflow-y: scroll;
  scrollbar-width: auto;
  scrollbar-color: var(--color-accent-secondary) rgba(0, 0, 0, 0.15);
  scrollbar-gutter: stable;
}

.ranking-answers-scrollable::-webkit-scrollbar {
  width: 14px;
  -webkit-appearance: none;
}

@media (max-width: 640px) {
  .ranking-answers-scrollable::-webkit-scrollbar {
    width: 24px;
  }
}

.ranking-answers-scrollable::-webkit-scrollbar-track {
  @apply bg-ink/15 rounded-lg;
  border: 1px solid var(--color-ink);
  margin: 4px 0;
}

.ranking-answers-scrollable::-webkit-scrollbar-thumb {
  @apply bg-accent-secondary rounded-lg;
  border: 2px solid var(--color-ink);
  min-height: 40px;
}

.ranking-answers-scrollable::-webkit-scrollbar-thumb:hover {
  @apply bg-accent-tertiary;
}

/* Fun Facts / Cycling Messages Component */
.cycling-messages {
  @apply relative min-h-30 flex items-center justify-center;
}

.message-card {
  @apply relative flex flex-col items-center gap-4 p-6;
  @apply rounded-2xl border-2 opacity-0 translate-y-5 transition-all duration-500 pointer-events-none;
  @apply bg-accent-blue/10 border-accent-blue/40
}

.message-card:not(.active) {
  @apply absolute invisible;
}

.message-card.active {
  @apply opacity-100 translate-y-0 pointer-events-auto;
}

/* Progress Dots Loading Indicator */
.progress-dots {
  @apply flex justify-center gap-3;
}

.progress-dot {
  @apply w-3 h-3 rounded-full animate-pulse-dot;
}
.progress-dot:nth-child(1) {
  @apply bg-accent-yellow;
}
.progress-dot:nth-child(2) {
  @apply bg-accent-blue;
  animation-delay: 0.3s;
}
.progress-dot:nth-child(3) {
  @apply bg-accent-red;
  animation-delay: 0.6s;
}

/* Story Editor Components */
.story-form-input {
  @apply w-full p-4 border-2 border-ink/30 rounded-lg text-base transition-all outline-none bg-white;
}

.story-form-input:focus {
  @apply border-accent-secondary ring-4 ring-accent-secondary/10;
}

.story-form-textarea {
  @apply w-full p-4 border-2 border-ink/30 rounded-lg text-base transition-all outline-none bg-white;
  @apply resize-y font-mono leading-relaxed;
}

.story-form-textarea:focus {
  @apply border-accent-secondary ring-4 ring-accent-secondary/10;
}

.blank-card {
  @apply flex flex-col bg-white p-4 rounded-lg border-2 border-ink/30 transition-all gap-2;
}

.blank-card:hover {
  @apply -translate-y-0.5 border-ink;
  box-shadow: 3px 3px 0px var(--color-ink);
}

.blank-id {
  @apply font-mono font-bold text-ink rounded-sm text-sm;
}

.tag {
  @apply inline-block px-2.5 py-1 rounded-full text-xs font-bold text-ink;
  background: var(--color-accent-tertiary);
  border: 2px solid var(--color-ink);
}

.blanks-help {
  @apply p-4 rounded-lg mb-6;
  background: rgba(255, 214, 10, 0.15);
  border: 2px dashed var(--color-ink);
}

.prompts-checklist {
  @apply flex flex-col gap-3 max-h-[300px] overflow-y-auto p-4 bg-white rounded-lg border-2 border-ink/20;
}

.prompt-item {
  @apply border-2 border-ink/30 rounded-lg p-5 transition-all;
}

.prompt-item:hover {
  @apply border-ink;
  box-shadow: 3px 3px 0px var(--color-ink);
}

.prompt-form {
  @apply animate-slide-in;
}

.prompt-checkbox {
  @apply flex gap-3 p-3 bg-white border-2 border-ink/20 rounded-md cursor-pointer transition-all;
}

.prompt-checkbox:hover {
  @apply border-ink;
  box-shadow: 2px 2px 0px var(--color-ink);
}

.new-prompt-field {
  @apply flex gap-2 items-start;
}
.new-prompt-field textarea {
  @apply flex-1;
}

/* Blank Modal Component */
.blank-modal {
  @apply fixed inset-0 z-modal flex items-center justify-center p-4 animate-fade-in;
}

.blank-modal.hidden {
  @apply hidden;
}

.blank-backdrop {
  @apply absolute inset-0 bg-black/50 backdrop-blur-sm;
}

.blank-content {
  @apply relative bg-white w-full max-w-[700px] max-h-[90vh];
  @apply overflow-hidden flex flex-col animate-slide-up;
  border: 3px solid var(--color-ink);
  border-radius: 1rem;
  box-shadow: 8px 8px 0px var(--color-ink);
}

/* Story Editor Buttons */
.btn-secondary {
  @apply px-6 py-3 rounded-lg font-semibold cursor-pointer transition-all text-base;
  @apply inline-flex items-center justify-center text-ink no-underline bg-white border-2 border-ink/30 whitespace-nowrap;
}

.btn-secondary:hover {
  @apply border-ink;
  box-shadow: 3px 3px 0px var(--color-ink);
}

.btn-secondary:focus-visible {
  outline: 3px solid var(--color-accent-secondary);
  outline-offset: 3px;
}

.btn-sm {
  @apply px-4 py-2 text-sm;
}

.btn-icon {
  @apply p-2 bg-transparent border-2 border-transparent rounded-lg cursor-pointer transition-all;
  @apply flex items-center justify-center;
}

.btn-icon:hover {
  @apply border-ink/20 scale-110;
  background: rgba(255, 214, 10, 0.2);
}

.btn-icon:focus-visible {
  outline: 3px solid var(--color-accent-secondary);
  outline-offset: 2px;
}

@media (prefers-reduced-motion: reduce) {
  .blank-card:hover,
  .btn-icon:hover {
    transform: none;
  }
}

/* Modal Components */

/* Shared modal close button */
.modal-close-btn {
  @apply bg-white border-2 border-ink rounded-lg p-2 cursor-pointer transition-all;
  @apply flex items-center justify-center;
  color: var(--color-ink);
  box-shadow: 2px 2px 0px var(--color-ink);
}

.modal-close-btn:hover {
  box-shadow: 3px 3px 0px var(--color-ink);
  transform: translate(-1px, -1px);
}

.modal-close-btn:focus-visible {
  outline: 3px solid var(--color-accent-secondary);
  outline-offset: 2px;
}

.modal-close-btn:active {
  box-shadow: 1px 1px 0px var(--color-ink);
  transform: translate(1px, 1px);
}

/* Light variant for dark backgrounds */
.modal-close-btn--light {
  @apply bg-white/20 border-white/40;
  color: white;
  box-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2);
}

.modal-close-btn--light:hover {
  @apply bg-white/30;
  box-shadow: 3px 3px 0px rgba(0, 0, 0, 0.2);
}

/* Settings Modal */
.settings-modal {
  @apply fixed inset-0 z-modal flex items-center justify-center p-4 animate-fade-in;
}

.settings-modal.hidden {
  @apply hidden;
}

.settings-backdrop {
  @apply absolute inset-0 bg-black/50 backdrop-blur-sm;
}

.settings-content {
  @apply relative bg-white rounded-2xl w-full max-w-[500px] overflow-hidden animate-slide-up;
  border: 3px solid var(--color-ink);
  box-shadow: 8px 8px 0px var(--color-ink);
}

/* Leave Game Modal */
.leave-game-modal {
  @apply fixed inset-0 z-modal flex items-center justify-center p-4 animate-fade-in;
}

.leave-game-modal.hidden {
  @apply hidden;
}

.leave-game-backdrop {
  @apply absolute inset-0 bg-black/50 backdrop-blur-sm;
}

.leave-game-content {
  @apply relative bg-white rounded-2xl w-full max-w-[380px] overflow-hidden animate-slide-up;
  border: 3px solid var(--color-ink);
  box-shadow: 8px 8px 0px var(--color-ink);
}

/* Leave Game Button - fixed top-right */
.leave-game-btn {
  @apply fixed top-4 right-4 z-controls p-2 bg-white rounded-xl cursor-pointer transition-all;
  @apply flex items-center justify-center;
  color: var(--color-ink);
  border: 2px solid var(--color-ink);
  box-shadow: 2px 2px 0px var(--color-ink);
}

@media (min-width: 640px) {
  .leave-game-btn {
    @apply top-5 right-5 p-2.5;
  }
}

.leave-game-btn:hover {
  box-shadow: 3px 3px 0px var(--color-ink);
  transform: translate(-1px, -1px);
}

.leave-game-btn:active {
  box-shadow: 1px 1px 0px var(--color-ink);
  transform: translate(1px, 1px);
}

@media (prefers-reduced-motion: reduce) {
  .leave-game-btn:hover,
  .leave-game-btn:active {
    transform: none;
  }
}

/* Discord Activity Navbar */
.discord-navbar {
  @apply fixed top-0 left-0 right-0 z-controls h-14 flex items-center px-4 gap-3;
  background-color: var(--color-bg-page);
  border-bottom: 3px solid var(--color-ink);
  box-shadow: 4px 4px 0px var(--color-ink);
}

.discord-phase-pill {
  @apply inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-sm font-semibold transition-all whitespace-nowrap;
}

/* Music Player Component */
.music-player-button {
  @apply fixed top-4 right-[72px] w-[50px] h-[50px] bg-white rounded-xl;
  @apply cursor-pointer transition-all z-music-button flex items-center justify-center;
  border: 3px solid var(--color-ink);
  box-shadow: 3px 3px 0px var(--color-ink);
  color: var(--color-ink);
}

.music-player-button:hover {
  box-shadow: 5px 5px 0px var(--color-ink);
  transform: translate(-2px, -2px);
}

.music-player-button:active {
  box-shadow: 2px 2px 0px var(--color-ink);
  transform: translate(1px, 1px);
}

.music-player-modal {
  @apply fixed inset-0 z-modal flex items-center justify-center animate-fade-in;
}

.music-player-modal.hidden {
  @apply hidden;
}

.music-player-backdrop {
  @apply absolute inset-0 bg-black/50 backdrop-blur-sm;
}

.music-player-content {
  @apply relative bg-white rounded-2xl w-[90%] max-w-[500px];
  @apply min-h-[450px] max-h-[80vh] overflow-hidden flex flex-col animate-slide-up;
  border: 3px solid var(--color-ink);
  box-shadow: 8px 8px 0px var(--color-ink);
}

.music-player-header {
  @apply p-6 flex justify-between items-center shrink-0;
  background-color: var(--color-accent-primary);
  color: white;
  border-bottom: 3px solid var(--color-ink);
}

.music-player-controls {
  @apply p-6 shrink-0;
  background-color: var(--color-bg-page);
  border-bottom: 3px solid var(--color-ink);
}

.control-btn {
  @apply bg-white w-12 h-12 rounded-xl cursor-pointer;
  @apply flex items-center justify-center transition-all;
  border: 2px solid var(--color-ink);
  box-shadow: 2px 2px 0px var(--color-ink);
  color: var(--color-ink);
}

.control-btn:hover {
  box-shadow: 3px 3px 0px var(--color-ink);
  transform: translate(-1px, -1px);
}

.control-btn:active {
  box-shadow: 1px 1px 0px var(--color-ink);
  transform: translate(1px, 1px);
}

.control-btn:focus-visible {
  outline: 3px solid var(--color-accent-secondary);
  outline-offset: 2px;
}

.control-btn.play-pause {
  @apply w-16 h-16;
  background-color: var(--color-accent-tertiary);
  border: 3px solid var(--color-ink);
  box-shadow: 3px 3px 0px var(--color-ink);
}

.control-btn.play-pause:hover {
  box-shadow: 4px 4px 0px var(--color-ink);
  transform: translate(-1px, -1px);
}

.progress-bar-container {
  @apply w-full h-3 rounded-full flex-1 min-h-0 cursor-pointer;
  background-color: rgba(26, 26, 46, 0.1);
  border: 2px solid var(--color-ink);
}

.progress-bar-fill {
  @apply h-full rounded-full transition-[width];
  background-color: var(--color-accent-secondary);
}

.music-player-songs {
  @apply overflow-y-auto rounded-xl flex-1 min-h-0 mt-4;
  border: 2px solid var(--color-ink);
}

/* Song items (dynamically generated by Stimulus controller) */
.song-item {
  @apply flex items-center gap-3 p-3 cursor-pointer transition-colors;
  border-bottom: 1px solid rgba(26, 26, 46, 0.1);
}

.song-item:last-child {
  border-bottom: none;
}

.song-item:hover {
  background-color: var(--color-bg-page);
}

.song-info {
  @apply flex-1 min-w-0;
}

.song-title {
  @apply font-bold whitespace-nowrap overflow-hidden text-ellipsis text-base;
  color: var(--color-ink);
}

.song-artist {
  @apply text-sm;
  color: rgba(26, 26, 46, 0.6);
}

.song-duration {
  @apply text-sm min-w-[40px] tabular-nums;
  color: rgba(26, 26, 46, 0.5);
}

/* Music player scrollbar */
.music-player-songs::-webkit-scrollbar {
  width: 8px;
}

.music-player-songs::-webkit-scrollbar-track {
  background: rgba(26, 26, 46, 0.05);
  border-radius: 4px;
}

.music-player-songs::-webkit-scrollbar-thumb {
  background-color: var(--color-accent-secondary);
  border-radius: 4px;
}

/* Responsive */
@media (max-width: 640px) {
  .music-player-content {
    @apply w-[95%] max-h-[90vh];
  }

  .music-player-header {
    @apply p-4;
  }

  .music-player-controls {
    @apply p-4;
  }

  .control-btn {
    @apply w-10 h-10;
  }

  .control-btn.play-pause {
    @apply w-14 h-14;
  }

  .song-duration {
    @apply hidden;
  }
}

/* Countdown Timer Component */
.countdown-timer {
  @apply relative inline-flex items-center justify-center w-[120px] h-[120px];
}

.countdown-timer-svg {
  @apply absolute w-full h-full -rotate-90;
}

.countdown-timer-circle-bg {
  fill: none;
  stroke: rgba(0, 0, 0, 0.1);
  stroke-width: 6;
}

.countdown-timer-circle {
  fill: none;
  stroke-width: 6;
  stroke-linecap: round;
  @apply transition-all duration-300;
}

/* Color phases */
.countdown-timer[data-phase="green"] .countdown-timer-circle {
  stroke: #22c55e;
}

.countdown-timer[data-phase="orange"] .countdown-timer-circle {
  stroke: #f97316;
}

.countdown-timer[data-phase="red"] .countdown-timer-circle {
  stroke: #ef4444;
}

/* Flash animation when time is up */
.countdown-timer[data-phase="zero"] .countdown-timer-circle-bg {
  stroke: #ef4444;
  @apply animate-flash-red;
}

.countdown-timer[data-phase="zero"] .countdown-timer-display {
  color: #ef4444;
  @apply animate-flash-red;
}

.countdown-timer-display {
  @apply text-lg font-bold text-gray-900 select-none z-[1];
  font-variant-numeric: tabular-nums;
}

/* Responsive sizing */
@media (max-width: 640px) {
  .countdown-timer {
    @apply w-[60px] h-[60px];
  }

  .countdown-timer-display {
    @apply text-base;
  }

  .countdown-timer-circle-bg,
  .countdown-timer-circle {
    stroke-width: 5;
  }
}

/* Small countdown timer variant (results auto-advance) */
.countdown-timer-sm {
  @apply w-[48px] h-[48px];
}

.countdown-timer-sm .countdown-timer-display {
  @apply text-sm;
}

.countdown-timer-sm .countdown-timer-circle-bg,
.countdown-timer-sm .countdown-timer-circle {
  stroke-width: 4;
}

/* Pause/play overlay */
.countdown-timer-pause-play {
  @apply absolute inset-0 flex items-center justify-center z-[2] text-ink/70;
}

/* When paused, always show the play icon (don't require hover) */
.countdown-timer[data-paused] .countdown-timer-pause-play:not(.hidden) {
  @apply opacity-100;
}

/* Dim number when overlay icon is visible */
.countdown-timer:hover .countdown-timer-display,
.countdown-timer[data-paused] .countdown-timer-display {
  @apply opacity-30;
}

/* Visual cue that timer is frozen */
.countdown-timer[data-paused] .countdown-timer-circle {
  @apply opacity-50;
}

button.countdown-timer {
  @apply cursor-pointer;
}

/* Extra-small countdown timer variant (Discord navbar) */
.countdown-timer-xs {
  @apply w-[36px] h-[36px] overflow-hidden;
}

.countdown-timer-xs .countdown-timer {
  @apply w-[36px] h-[36px];
}

.countdown-timer-xs .countdown-timer-display {
  @apply text-xs;
}

.countdown-timer-xs .countdown-timer-circle-bg,
.countdown-timer-xs .countdown-timer-circle {
  stroke-width: 3;
}

/* Flash Messages */
.flash-message {
  @apply flex items-center justify-between gap-3 px-5 py-4 rounded-xl shadow-xl;
  @apply animate-slide-in-right transition-all;
}

.flash-notice {
  @apply bg-success text-white;
}

.flash-alert {
  @apply bg-error text-white;
}

.flash-dismiss {
  @apply shrink-0 bg-transparent border-none text-xl leading-none cursor-pointer;
  @apply p-1 rounded-sm transition-all opacity-70 text-white;
}

.flash-dismiss:hover {
  @apply opacity-100 scale-110;
  background: rgba(0, 0, 0, 0.1);
}

.flash-dismiss:active {
  @apply scale-95;
}

.flash-dismiss:focus {
  @apply outline-2 outline-current outline-offset-2;
}

@media (prefers-reduced-motion: reduce) {
  .flash-dismiss:hover,
  .flash-dismiss:active {
    transform: none;
  }
}


/* Scroll fade indicators - shows shadow-style fades at top/bottom edges when scrollable */
/* Uses background-attachment: local/scroll technique for shadow effect */
.scroll-fade-indicators {
  --fade-size: 32px;
  background:
    linear-gradient(white 30%, rgba(255, 255, 255, 0)) center top,
    linear-gradient(rgba(255, 255, 255, 0), white 70%) center bottom,
    radial-gradient(farthest-side at 50% 0, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0)) center top,
    radial-gradient(farthest-side at 50% 100%, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0)) center bottom;
  background-repeat: no-repeat;
  background-size: 100% 60px, 100% 50px, 100% 14px, 100% 14px;
  background-attachment: local, local, scroll, scroll;
}

/* Scroll fade overlay - uses sticky pseudo-elements on top of content */
/* Works with opaque child backgrounds unlike scroll-fade-indicators */
.scroll-fade-overlay {
  --fade-color: rgba(0, 0, 0, 0.3);
  --fade-size: 14px;
}

.scroll-fade-overlay::before,
.scroll-fade-overlay::after {
  content: '';
  display: block;
  position: sticky;
  left: 0;
  right: 0;
  height: var(--fade-size);
  pointer-events: none;
  z-index: 1;
  transition: opacity 0.2s ease;
}

.scroll-fade-overlay::before {
  top: 0;
  margin-bottom: calc(-1 * var(--fade-size));
  background: radial-gradient(ellipse at center top, var(--fade-color), transparent 70%);
}

.scroll-fade-overlay::after {
  bottom: 0;
  margin-top: calc(-1 * var(--fade-size));
  background: radial-gradient(ellipse at center bottom, var(--fade-color), transparent 70%);
}

.scroll-fade-overlay[data-scroll-top]::before {
  opacity: 0;
}

.scroll-fade-overlay[data-scroll-bottom]::after {
  opacity: 0;
}

@media (prefers-reduced-motion: reduce) {
  .scroll-fade-overlay::before,
  .scroll-fade-overlay::after {
    display: none;
  }
}

/* Roaming avatar tooltip - shown on tap to display user name */
.roaming-avatar-tooltip {
  @apply absolute z-controls px-3 py-1.5 rounded-xl text-sm font-bold whitespace-nowrap pointer-events-none animate-roaming-tooltip-fade-in;
  bottom: 100%;
  left: 50%;
  margin-bottom: 4px;
  background-color: var(--color-accent-tertiary);
  color: var(--color-ink);
  border: 2px solid var(--color-ink);
  box-shadow: 2px 2px 0px var(--color-ink);
}

.roaming-avatar-status {
  @apply absolute z-controls text-xs font-bold leading-none pointer-events-none;
  top: -4px;
  right: -4px;
}

.roaming-avatar-status--pending {
  @apply text-ink/70;
  animation: pulse 1.5s ease-in-out infinite;
}

.roaming-avatar-status--done {
  @apply text-accent-green;
}

/* Current user's avatar â€” brighter bg + periodic shimmer */
.roaming-avatar--self {
  overflow: visible;
}

.roaming-avatar--self::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: linear-gradient(
    120deg,
    transparent 30%,
    rgba(255, 255, 255, 0.4) 50%,
    transparent 70%
  );
  background-size: 200% 100%;
  animation: avatar-shimmer 5s ease-in infinite;
  pointer-events: none;
}

/* Spark particles that burst outward on submit */
.roaming-avatar-spark {
  @apply absolute rounded-full pointer-events-none;
  width: 8px;
  height: 8px;
  top: 50%;
  left: 50%;
  margin-top: -4px;
  margin-left: -4px;
  background-color: var(--spark-color, var(--color-accent-primary));
  box-shadow: 0 0 4px var(--spark-color, var(--color-accent-primary));
  animation: avatar-spark-pop var(--spark-duration, 0.8s) ease-out forwards;
}

/* Red flash when changing an answer */
.roaming-avatar--flash-red {
  animation: avatar-flash-red 0.4s ease-out !important;
}

/* TODO: can the below classes be accomplished with out components.css? Does it matter? */

/* Staggered entrance animation for lists */
.stagger-animation > *:nth-child(1) { animation-delay: 0s; }
.stagger-animation > *:nth-child(2) { animation-delay: 0.05s; }
.stagger-animation > *:nth-child(3) { animation-delay: 0.1s; }
.stagger-animation > *:nth-child(4) { animation-delay: 0.15s; }
.stagger-animation > *:nth-child(5) { animation-delay: 0.2s; }
.stagger-animation > *:nth-child(6) { animation-delay: 0.25s; }
.stagger-animation > *:nth-child(7) { animation-delay: 0.3s; }
.stagger-animation > *:nth-child(8) { animation-delay: 0.35s; }
.stagger-animation > *:nth-child(9) { animation-delay: 0.4s; }
.stagger-animation > *:nth-child(10) { animation-delay: 0.45s; }
.stagger-animation > *:nth-child(11) { animation-delay: 0.5s; }
.stagger-animation > *:nth-child(12) { animation-delay: 0.55s; }
.stagger-animation > *:nth-child(n+13) { animation-delay: 0.6s; }

/* Rainbow cycling colors for player list items */
.rainbow-cycle > *:nth-child(7n+1) { background-color: var(--color-accent-red); }
.rainbow-cycle > *:nth-child(7n+2) { background-color: var(--color-accent-orange); }
.rainbow-cycle > *:nth-child(7n+3) { background-color: var(--color-accent-yellow); }
.rainbow-cycle > *:nth-child(7n+4) { background-color: var(--color-accent-green); }
.rainbow-cycle > *:nth-child(7n+5) { background-color: var(--color-accent-blue); }
.rainbow-cycle > *:nth-child(7n+6) { background-color: var(--color-accent-indigo); }
.rainbow-cycle > *:nth-child(7n+0) { background-color: var(--color-accent-violet); }

/* Playful tilts for chaos effect */
.playful-tilt > *:nth-child(8n+1) { transform: rotate(-2deg); }
.playful-tilt > *:nth-child(8n+2) { transform: rotate(1.5deg); }
.playful-tilt > *:nth-child(8n+3) { transform: rotate(-1deg); }
.playful-tilt > *:nth-child(8n+4) { transform: rotate(2.5deg); }
.playful-tilt > *:nth-child(8n+5) { transform: rotate(-1.5deg); }
.playful-tilt > *:nth-child(8n+6) { transform: rotate(1deg); }
.playful-tilt > *:nth-child(8n+7) { transform: rotate(-2.5deg); }
.playful-tilt > *:nth-child(8n+0) { transform: rotate(2deg); }

/* ============================================
   AVATAR CAROUSEL COMPONENT
   ============================================ */

.carousel-arrow {
  @apply flex items-center justify-center w-12 h-12 max-sm:w-10 max-sm:h-10;
  @apply bg-white rounded-xl cursor-pointer transition-all;
  @apply text-ink z-avatars;
  border: 2px solid var(--color-ink);
  box-shadow: 2px 2px 0px var(--color-ink);
}

@media (hover: hover) {
  .carousel-arrow:hover {
    box-shadow: 4px 4px 0px var(--color-ink);
    transform: translate(-2px, -2px);
  }
}

.carousel-arrow:active {
  box-shadow: 1px 1px 0px var(--color-ink);
  transform: translate(1px, 1px);
}

.carousel-arrow:focus-visible {
  outline: 3px solid var(--color-accent-secondary);
  outline-offset: 2px;
}

.avatar-carousel-container {
  @apply flex items-center justify-center rounded-2xl transition-all;
  @apply select-none overflow-hidden relative;
  width: 180px;
  min-height: 90px;
  background: var(--color-accent-secondary-light);
  border: 3px solid var(--color-ink);
  box-shadow: 4px 4px 0px var(--color-ink);
}

.avatar-carousel-container.avatar-taken {
  @apply opacity-50;
  background: rgba(0, 0, 0, 0.05);
}

.avatar-carousel-container.avatar-current {
  background: var(--color-accent-tertiary);
}

.avatar-carousel-container.avatar-available {
  background: var(--color-accent-secondary-light);
}

@media (hover: hover) {
  .avatar-carousel-container.avatar-available:hover {
    box-shadow: 6px 6px 0px var(--color-ink);
    transform: translate(-2px, -2px);
  }
}

.avatar-main-display {
  @apply flex items-center justify-center px-2 py-3;
}

.avatar-emoji {
  @apply text-6xl max-sm:text-5xl leading-none;
  transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.avatar-emoji.slide-out-left {
  animation: avatar-slide-out-left 0.15s ease-in forwards;
}

.avatar-emoji.slide-out-right {
  animation: avatar-slide-out-right 0.15s ease-in forwards;
}

.avatar-emoji.slide-in-left {
  animation: avatar-slide-in-left 0.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

.avatar-emoji.slide-in-right {
  animation: avatar-slide-in-right 0.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes avatar-slide-out-left {
  from { transform: translateX(0) scale(1); opacity: 1; }
  to { transform: translateX(-20px) scale(0.8); opacity: 0; }
}

@keyframes avatar-slide-out-right {
  from { transform: translateX(0) scale(1); opacity: 1; }
  to { transform: translateX(20px) scale(0.8); opacity: 0; }
}

@keyframes avatar-slide-in-left {
  from { transform: translateX(20px) scale(0.8); opacity: 0; }
  to { transform: translateX(0) scale(1); opacity: 1; }
}

@keyframes avatar-slide-in-right {
  from { transform: translateX(-20px) scale(0.8); opacity: 0; }
  to { transform: translateX(0) scale(1); opacity: 1; }
}

/* Side indicators - same size as main, positioned at edge with half clipped */
.avatar-side-indicator {
  @apply text-6xl max-sm:text-5xl leading-none transition-all;
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  opacity: 0.4;
}

.avatar-side-indicator.left {
  left: 0;
  transform: translateY(-50%) translateX(-25%);
}

.avatar-side-indicator.right {
  right: 0;
  transform: translateY(-50%) translateX(25%);
}

/* Spin animation for shuffle */
.animate-spin-once {
  animation: spin-once 0.3s ease-in-out;
}

@keyframes spin-once {
  0% { transform: rotate(0deg) scale(1); }
  50% { transform: rotate(180deg) scale(0.8); }
  100% { transform: rotate(360deg) scale(1); }
}

/* Rejection animation â€” red flash + horizontal shake */
.avatar-carousel-container.avatar-rejection {
  animation: avatar-rejection-shake 0.4s ease-out;
}

@keyframes avatar-rejection-shake {
  0%   { background-color: rgba(239, 68, 68, 0.3); transform: translateX(0); }
  15%  { background-color: rgba(239, 68, 68, 0.4); transform: translateX(-6px); }
  30%  { background-color: rgba(239, 68, 68, 0.3); transform: translateX(5px); }
  45%  { background-color: rgba(239, 68, 68, 0.2); transform: translateX(-4px); }
  60%  { background-color: rgba(239, 68, 68, 0.1); transform: translateX(3px); }
  75%  { transform: translateX(-1px); }
  100% { transform: translateX(0); }
}

@media (prefers-reduced-motion: reduce) {
  .avatar-emoji.slide-out-left,
  .avatar-emoji.slide-out-right,
  .avatar-emoji.slide-in-left,
  .avatar-emoji.slide-in-right,
  .animate-spin-once,
  .avatar-carousel-container.avatar-rejection {
    animation: none;
  }

  .carousel-arrow:hover,
  .carousel-arrow:active,
  .avatar-carousel-container.avatar-available:hover {
    transform: none;
  }
}

  /* Status phase cards - header and content with colored left border */
  /* Note: card-subdued styles inlined because @apply cannot reference custom classes in the same file */
  .card-status-header-blue {
    @apply bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-8 text-center mb-8 border-l-4;
    @apply border-accent-blue/40 border-l-accent-blue bg-accent-blue/10;
    border: 2px solid rgba(26, 26, 46, 0.2);
  }

  .card-status-header-indigo {
    @apply bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-8 text-center mb-8 border-l-4;
    @apply border-accent-indigo/40 border-l-accent-indigo bg-accent-indigo/10;
    border: 2px solid rgba(26, 26, 46, 0.2);
  }

  .card-status-header-violet {
    @apply bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-8 text-center mb-8 border-l-4;
    @apply border-accent-violet/40 border-l-accent-violet bg-accent-violet/10;
    border: 2px solid rgba(26, 26, 46, 0.2);
  }

  .card-status-header-green {
    @apply bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-8 text-center mb-8 border-l-4;
    @apply border-accent-green/40 border-l-accent-green bg-accent-green/10;
    border: 2px solid rgba(26, 26, 46, 0.2);
  }

  .card-status-content-blue {
    @apply bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-8 flex-1 min-h-0 border-l-4;
    @apply border-accent-blue/40 border-l-accent-blue;
    border: 2px solid rgba(26, 26, 46, 0.2);
  }

  .card-status-content-indigo {
    @apply bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-8 flex-1 min-h-0 border-l-4;
    @apply border-accent-indigo/40 border-l-accent-indigo;
    border: 2px solid rgba(26, 26, 46, 0.2);
  }

  .card-status-content-violet {
    @apply bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-8 flex-1 min-h-0 border-l-4;
    @apply border-accent-violet/40 border-l-accent-violet;
    border: 2px solid rgba(26, 26, 46, 0.2);
  }

  .card-status-content-green {
    @apply bg-white/80 backdrop-blur-sm rounded-2xl p-6 md:p-8 flex-1 min-h-0 border-l-4;
    @apply border-accent-green/40 border-l-accent-green bg-accent-green/10;
    border: 2px solid rgba(26, 26, 46, 0.2);
  }

/* ============================================
   TUTORIAL HINTS COMPONENT
   ============================================ */

/* z-hints: Above controls layer, below modals */
.tutorial-hint {
  @apply fixed z-hints pointer-events-auto animate-tooltip-fade-in;
}

.tutorial-hint.hidden {
  @apply hidden;
}

/* Settings hint - top right, pointing toward gear button */
.tutorial-hint--settings {
  top: 12px;
  right: 70px;
}

/* Music hint - top right, pointing toward music button */
.tutorial-hint--music {
  top: 12px;
  right: 120px;
}

.tutorial-hint-content {
  @apply relative flex items-center gap-2 px-4 py-3 rounded-xl text-sm font-semibold;
  background-color: var(--color-accent-tertiary);
  color: var(--color-ink);
  border: 2px solid var(--color-ink);
  box-shadow: 3px 3px 0px var(--color-ink);
  animation: hint-bounce 2s ease-in-out 0.3s 3;
}

@keyframes hint-bounce {
  0%, 100% { transform: translateX(0); }
  10%, 30% { transform: translateX(-4px); }
  20% { transform: translateX(4px); }
  40% { transform: translateX(0); }
}

.tutorial-hint--music .tutorial-hint-content {
  animation: hint-bounce 2s ease-in-out 0.3s 3;
}

@keyframes hint-bounce-right {
  0%, 100% { transform: translateX(0); }
  10%, 30% { transform: translateX(4px); }
  20% { transform: translateX(-4px); }
  40% { transform: translateX(0); }
}

.tutorial-hint-text {
  @apply whitespace-nowrap;
}

.tutorial-hint-dismiss {
  @apply flex items-center justify-center w-5 h-5 rounded-full cursor-pointer transition-opacity;
  @apply bg-transparent border-none p-0;
  color: var(--color-ink);
  opacity: 0.5;
}

.tutorial-hint-dismiss:hover {
  opacity: 1;
}

/* Arrow pointing right (toward settings gear) */
.tutorial-hint-arrow--right {
  @apply absolute;
  right: -10px;
  top: 50%;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-top: 8px solid transparent;
  border-bottom: 8px solid transparent;
  border-left: 10px solid var(--color-ink);
}

.tutorial-hint-arrow--right::before {
  content: '';
  @apply absolute;
  right: 2px;
  top: -6px;
  width: 0;
  height: 0;
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-left: 8px solid var(--color-accent-tertiary);
}

/* Arrow pointing left (toward music button) */
.tutorial-hint-arrow--left {
  @apply absolute;
  left: -10px;
  top: 50%;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-top: 8px solid transparent;
  border-bottom: 8px solid transparent;
  border-right: 10px solid var(--color-ink);
}

.tutorial-hint-arrow--left::before {
  content: '';
  @apply absolute;
  left: 2px;
  top: -6px;
  width: 0;
  height: 0;
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-right: 8px solid var(--color-accent-tertiary);
}

/* Hide on very small screens */
@media (max-width: 400px) {
  .tutorial-hint {
    @apply hidden;
  }
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .tutorial-hint-content {
    animation: none;
  }
}

/* ============================================
   ACCORDION COMPONENT
   Playful collapsible sections for story selection
   ============================================ */

.accordion-section {
  @apply bg-white rounded-xl overflow-clip;
  border: 3px solid var(--color-ink);
  box-shadow: 4px 4px 0px var(--color-ink);
}

.accordion-header {
  @apply flex items-center justify-between px-5 py-4 cursor-pointer select-none;
  @apply font-bold text-lg transition-colors;
  background: var(--color-accent-tertiary-light);
  color: var(--color-ink);
}

.accordion-header:hover {
  background: var(--color-accent-tertiary);
}

.accordion-chevron {
  @apply transition-transform duration-300;
}

.accordion-chevron-expanded {
  transform: rotate(180deg);
}

.accordion-content {
  @apply overflow-hidden transition-all duration-300 ease-out;
  max-height: var(--accordion-max-height, 100vh);
}

.accordion-content-collapsed {
  max-height: 0;
}

.accordion-summary {
  @apply px-5 py-3 text-sm font-medium border-t-2;
  border-color: rgba(26, 26, 46, 0.1);
  color: rgba(26, 26, 46, 0.7);
  background: var(--color-bg-page);
}

.accordion-summary strong {
  color: var(--color-ink);
}

/* Search input with icon */
.search-input-container {
  @apply relative;
}

.search-input {
  @apply w-full pl-11 pr-4 py-3 text-base font-medium rounded-xl outline-none transition-all;
  border: 2px solid rgba(26, 26, 46, 0.2);
  background: white;
}

.search-input:hover {
  border-color: var(--color-ink);
}

.search-input:focus {
  border-color: var(--color-accent-secondary);
  box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.1);
}

.search-input::placeholder {
  @apply font-normal;
  color: rgba(26, 26, 46, 0.4);
}

.search-input-icon {
  @apply absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none;
  color: rgba(26, 26, 46, 0.4);
}

@media (prefers-reduced-motion: reduce) {
  .accordion-content {
    transition: none;
  }

  .accordion-chevron {
    transition: none;
  }
}

/* ============================================
   MULTI-SELECT COMPONENT
   Mantine-inspired with Blanksies playful styling
   ============================================ */

.multi-select {
  @apply relative w-full;
}

.multi-select-container {
  @apply flex flex-wrap items-center gap-2 p-3 min-h-[52px];
  @apply bg-white rounded-xl cursor-text;
  border: 2px solid rgba(26, 26, 46, 0.2);
  transition: all 0.2s ease;
}

.multi-select-container:hover {
  border-color: var(--color-ink);
}

.multi-select-container:focus-within {
  border-color: var(--color-accent-secondary);
  box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.1);
}

.multi-select-pills {
  @apply flex flex-wrap gap-2;
}

.multi-select-pill {
  @apply inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full;
  @apply text-sm font-bold;
  background: var(--color-accent-tertiary);
  color: var(--color-ink);
  border: 2px solid var(--color-ink);
  box-shadow: 2px 2px 0px var(--color-ink);
}

.multi-select-pill.animate-pop {
  animation: var(--animate-pop);
}

.multi-select-pill-remove {
  @apply flex items-center justify-center w-5 h-5 -mr-1 rounded-full;
  @apply bg-transparent border-none cursor-pointer transition-all;
  color: var(--color-ink);
  opacity: 0.6;
}

.multi-select-pill-remove:hover {
  opacity: 1;
  background: rgba(26, 26, 46, 0.1);
}

.multi-select-input {
  @apply flex-1 min-w-[120px] bg-transparent border-none outline-none;
  @apply text-base font-medium;
  color: var(--color-ink);
}

.multi-select-input::placeholder {
  color: rgba(26, 26, 46, 0.4);
}

.multi-select-dropdown {
  @apply absolute z-controls left-0 right-0 mt-2;
  @apply bg-white rounded-xl overflow-hidden;
  border: 2px solid var(--color-ink);
  box-shadow: 4px 4px 0px var(--color-ink);
  animation: dropdown-appear 0.15s ease-out;
}

@keyframes dropdown-appear {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}

.multi-select-dropdown.hidden {
  @apply hidden;
}

.multi-select-options {
  @apply max-h-[200px] overflow-y-auto p-1;
}

.multi-select-option {
  @apply w-full text-left px-4 py-3 rounded-lg;
  @apply text-base font-medium cursor-pointer transition-all;
  @apply bg-transparent border-none;
  color: var(--color-ink);
}

.multi-select-option:hover,
.multi-select-option.highlighted {
  background: var(--color-accent-tertiary-light);
}

.multi-select-option:active {
  background: var(--color-accent-tertiary);
}

.multi-select-empty {
  @apply px-4 py-3 text-center italic;
  color: rgba(26, 26, 46, 0.5);
}

/* Pill animations */
@keyframes pill-shrink {
  to { transform: scale(0); opacity: 0; }
}

.multi-select-pill.animate-shrink {
  animation: pill-shrink 0.15s ease-out forwards;
}

@media (prefers-reduced-motion: reduce) {
  .multi-select-dropdown,
  .multi-select-pill.animate-pop,
  .multi-select-pill.animate-shrink {
    animation: none;
  }
}

/* ============================================
   KONAMI CODE EASTER EGG
   ============================================ */

.konami-overlay {
  position: fixed;
  inset: 0;
  z-index: var(--z-index-easter-egg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(4px);
  overflow: hidden;
  cursor: pointer;
  animation: konami-fade-in 0.3s ease-out;
}

.konami-overlay--dismissing {
  animation: konami-fade-out 0.4s ease-in forwards;
}

.konami-text {
  position: relative;
  z-index: 1;
  font-size: clamp(2.5rem, 8vw, 6rem);
  font-weight: 900;
  line-height: 1.1;
  text-align: center;
  max-width: 80vw;
  color: white;
  padding: 0.1em 0.3em;
  background: var(--color-accent-primary);
  border: 4px solid var(--color-ink);
  box-shadow: 8px 8px 0px var(--color-ink);
  border-radius: 0.25em;
  transform: rotate(-2deg);
  animation: konami-chaos 0.3s ease-in-out infinite alternate;
}

.konami-hint {
  position: relative;
  z-index: 1;
  margin-top: 2rem;
  font-size: 1rem;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.6);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  animation: konami-fade-in 0.5s ease-out 0.5s both;
}

.konami-confetti {
  position: absolute;
  top: -20px;
  z-index: 0;
  pointer-events: none;
  animation: konami-confetti-fall linear forwards;
}

.konami-confetti--square {
  width: 12px;
  height: 12px;
  border-radius: 2px;
}

.konami-confetti--circle {
  width: 10px;
  height: 10px;
  border-radius: 50%;
}

.konami-confetti--strip {
  width: 6px;
  height: 18px;
  border-radius: 2px;
}

.konami-confetti--large-square {
  width: 20px;
  height: 20px;
  border-radius: 3px;
}

.konami-confetti--large-circle {
  width: 16px;
  height: 16px;
  border-radius: 50%;
}

.konami-confetti--tumble {
  animation-name: konami-confetti-tumble;
}

.konami-canvas {
  position: absolute;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

@keyframes konami-fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes konami-fade-out {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes konami-chaos {
  0% {
    transform: rotate(-6deg) translate(-12px, 5px) scale(0.92);
  }
  14% {
    transform: rotate(5deg) translate(10px, -8px) scale(1.08);
  }
  28% {
    transform: rotate(-8deg) translate(-8px, -12px) scale(0.95);
  }
  42% {
    transform: rotate(4deg) translate(15px, 6px) scale(1.05);
  }
  57% {
    transform: rotate(-3deg) translate(-15px, -4px) scale(1.08);
  }
  71% {
    transform: rotate(7deg) translate(6px, 10px) scale(0.93);
  }
  85% {
    transform: rotate(-5deg) translate(12px, -10px) scale(1.06);
  }
  100% {
    transform: rotate(6deg) translate(-10px, 8px) scale(0.96);
  }
}

@keyframes konami-confetti-fall {
  0% {
    transform: translateY(0) translateX(0) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(100vh) translateX(var(--drift, 0px)) rotate(var(--spin, 360deg));
    opacity: 0;
  }
}

@keyframes konami-confetti-tumble {
  0% {
    transform: translateY(0) translateX(0) rotate(0deg) scaleX(1);
    opacity: 1;
  }
  25% {
    transform: translateY(25vh) translateX(calc(var(--drift, 0px) * 0.3)) rotate(calc(var(--spin, 360deg) * 0.25)) scaleX(-1);
  }
  50% {
    transform: translateY(50vh) translateX(calc(var(--drift, 0px) * -0.2)) rotate(calc(var(--spin, 360deg) * 0.6)) scaleX(1);
    opacity: 1;
  }
  75% {
    transform: translateY(75vh) translateX(calc(var(--drift, 0px) * 0.8)) rotate(calc(var(--spin, 360deg) * 0.85)) scaleX(-1);
  }
  100% {
    transform: translateY(100vh) translateX(var(--drift, 0px)) rotate(var(--spin, 360deg)) scaleX(1);
    opacity: 0;
  }
}

@media (prefers-reduced-motion: reduce) {
  .konami-overlay {
    animation: none;
  }

  .konami-overlay--dismissing {
    animation: none;
    opacity: 0;
  }

  .konami-text {
    animation: none;
    transform: none;
  }

  .konami-hint {
    animation: none;
  }

  .konami-confetti {
    display: none;
  }

  .konami-canvas {
    display: none;
  }
}
