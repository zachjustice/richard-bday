<%= turbo_stream_from "rooms:#{@room.id}:status" %>

<%# This page is typically viewed by players from a shared screen. Normally a TV. %>
<%# Text and content should be easily viewable from a distance %>
<div class="h-screen overflow-hidden flex flex-col bg-page relative"
     data-controller="room-status settings-modal tutorial-hints"
     data-tutorial-hints-editor-authenticated-value="<%= !!editor_authenticated? %>"
     data-action="settings-modal:opened->tutorial-hints#syncCheckbox">
  <%# Floating branded text - top left %>
  <div class="fixed top-4 left-4 z-controls flex items-baseline gap-3">
    <span class="text-2xl font-bold text-ink text-shadow-brand"><%= link_to "Blanksies", root_path %></span>
    <span class="text-sm text-ink/60 font-medium">Join using code <span class="font-bold tracking-widest text-ink"><%= @room.code.upcase %></span></span>
  </div>

  <%# Floating settings - top right %>
  <button type="button"
          class="fixed top-4 right-4 z-controls p-2 bg-white rounded-xl cursor-pointer transition-all hover:scale-110 active:scale-95 text-xl border-3 border-ink"
          style="box-shadow: 3px 3px 0px var(--color-ink);"
          data-action="click->settings-modal#toggle"
    aria-label="Open settings">
    ⚙️
  </button>

  <%= render "rooms/settings/settings_modal", room: @room %>

  <%# Tutorial hints for first-time users %>
  <%= render "shared/tutorial_hint",
      position: "settings",
      target: "settingsHint",
      dismiss_action: "dismissSettings",
      text: "Adjust game timing here",
      arrow_direction: "right" %>

  <%= render "shared/tutorial_hint",
      position: "music",
      target: "musicHint",
      dismiss_action: "dismissMusic",
      text: "Play background music",
      arrow_direction: "right" %>

  <div id="status-content-inner" class="flex-1 min-h-0 flex items-center justify-center px-6 py-14">
    <div class="card-primary p-0 m-0 max-w-[1400px] w-full max-h-full flex flex-row min-h-0 z-content">
      <div id="turbo-target-sidebar" class="flex">
        <% if @room.current_game&.story.present? && [RoomStatus::Answering, RoomStatus::Voting, RoomStatus::Results, RoomStatus::FinalResults].include?(@status) %>
          <%= render partial: "rooms/status/sidebar", locals: @status_data %>
        <% end %>
      </div>

      <div id="turbo-target-status-page" class="flex-1 flex flex-col justify-start p-6 min-h-0 min-w-0">
        <% case @status %>
        <% when RoomStatus::WaitingRoom %>
          <%= render partial: "rooms/status/waiting_room", locals: @status_data %>
        <% when RoomStatus::StorySelection %>
          <%= render partial: "rooms/status/story_selection", locals: @status_data %>
        <% when RoomStatus::Answering %>
          <%= render partial: "rooms/status/answering", locals: @status_data %>
        <% when RoomStatus::Voting %>
          <%= render partial: "rooms/status/voting", locals: @status_data %>
        <% when RoomStatus::Results %>
          <%= render partial: "rooms/status/results", locals: @status_data %>
        <% when RoomStatus::FinalResults %>
          <%= render partial: "rooms/status/final_results", locals: @status_data %>
        <% when RoomStatus::Credits %>
          <%= render partial: "rooms/status/credits", locals: @status_data %>
        <% end %>
      </div>
    </div>
  </div>

  <%# Music Controls / Player %>
  <%= render "shared/music_player" %>
</div>
