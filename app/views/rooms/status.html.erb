<%= stylesheet_link_tag "room-status", "data-turbo-track": "reload" %>
<%= turbo_stream_from "rooms:#{@room.id}:status" %>
<%= render "rooms/status/header" %>
<div class="status-content" data-controller="room-status">

  <%= tag.div(flash[:notice], class: "error-notice") if flash[:notice] %>
  <div id="status-content-inner" class="status-content-inner">
    <div class="status-page-card">
      <div id="turbo-target-sidebar" class="turbo-target-sidebar">
        <% if @room.current_game.present? %>
          <%= render partial: "rooms/status/sidebar", locals: @status_data %>
        <% end %>
      </div>
      <div id="turbo-target-status-page" class="status-page-card">
        <% case @status %>
        <% when RoomStatus::WaitingRoom %>
          <%= render partial: "rooms/status/waiting_room", locals: @status_data %>
        <% when RoomStatus::Answering %>
          <%= render partial: "rooms/status/answering", locals: @status_data %>
        <% when RoomStatus::Voting %>
          <%= render partial: "rooms/status/voting", locals: @status_data %>
        <% when RoomStatus::Results %>
          <%= render partial: "rooms/status/results", locals: @status_data %>
        <% when RoomStatus::FinalResults %>
          <%= render partial: "rooms/status/final_results", locals: @status_data %>
        <% end %>
      </div>
    </div>
    <% if @room.status == RoomStatus::WaitingRoom %>
      <div class="qr-code">
        <span>Scan the QR code to join the game:</span>
        <img id="qr-code" src="">
        <span>Or visit <a href="https://blanksies.zachjustice.dev">blanksies.zachjustice.dev</a></span>
      </div>
    <% end %>
  </div>

  <div class="audio-controls" data-controller="background-audio" data-turbo-permanent>
    <audio 
      data-background-audio-target="audio"
      src="<%= asset_path('life-of-a-wandering-wizard.mp3') %>">
    </audio>

    <!-- Play / Pause Button -->
    <button
      data-action="background-audio#togglePlay"
      data-background-audio-target="playButton"
    >
      <span data-background-audio-target="playIcon" class="icon">
        üîä
      </span>
      <span data-background-audio-target="pauseIcon" class="icon pauseIcon hidden">
        ‚ùå
      </span>
    </button>
  </div>
</div>