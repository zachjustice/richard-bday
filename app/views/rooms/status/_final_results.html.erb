<div class="flex-1 flex flex-col justify-start min-h-0"
     data-controller="share-story">
  <div class="card-status-header-green"
       data-controller="speech"
       data-speech-text-value="<%= render_plaintext(story_text, blank_id_to_answer_text) %>">
    <div class="relative w-full text-center">
      <h2 class="text-2xl max-md:text-xl font-bold text-ink m-0">
        <%= current_room.current_game.story.title %>
      </h2>
    </div>

    <div class="flex flex-col items-center gap-2 mt-4">
      <span class="text-sm font-medium text-ink/60 italic">Written by:</span>
      <div class="flex flex-wrap gap-2 justify-center">
        <% users.each do |user| %>
          <span class="px-3 py-1 rounded-full text-sm font-semibold text-ink border-2 border-ink/20 bg-accent-green/10"><%= user.avatar_with_name %></span>
        <% end %>
      </div>
    </div>

    <div class="flex mt-6 gap-2 justify-center flex-wrap">
      <button type="button"
              class="btn-primary text-sm"
              data-action="click->share-story#share"
        data-share-story-target="shareButton">
        ðŸ“¥ Download Story
      </button>

      <button class="btn-primary bg-accent-blue text-sm" type="button" data-action="click->speech#speak">
        ðŸ”Š Read Aloud
      </button>

      <%= form_with url: room_credits_path(current_room), method: :post, class: "inline" do |form| %>
        <%= form.submit "View Credits", class: "btn-primary bg-accent-orange text-sm" %>
      <% end %>
    </div>
  </div>
  <div class="card-status-content-green overflow-y-auto">
    <p class="text-lg max-md:text-base text-ink leading-relaxed m-0 text-justify max-md:text-left">
      <%= simple_format(render_story_with_tooltips(story_text, blank_id_to_answer_text), {}, sanitize: false) %>
    </p>
  </div>

  <!-- Hidden export container for image download -->
  <div id="story-export-container"
       class="hidden"
       data-share-story-target="exportContainer">
    <%= render "rooms/status/story_export_container",
         story_title: current_room.current_game.story.title,
         authors: users.map(&:name),
         story_text: story_text,
         blank_id_to_answer_text: blank_id_to_answer_text %>
  </div>
</div>
