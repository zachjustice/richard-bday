<% form_saved = local_assigns.fetch(:form_saved, false) %>
<%= form_with model: room,
              url: update_room_settings_path(room),
              method: :patch,
              data: {
                turbo_frame: "settings-form",
                action: "turbo:submit-start->settings-modal#submitting turbo:submit-end->settings-modal#submitted"
              },
              class: "p-8 flex flex-col gap-6" do |form| %>
  <% if room.errors.any? %>
    <div class="p-4 rounded-xl border-3 border-accent-primary bg-accent-primary/10 mb-4">
      <% room.errors.full_messages.each do |message| %>
        <p class="flex items-center gap-2 text-accent-primary text-sm font-medium m-0">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
            <circle cx="10" cy="10" r="8"/>
            <path d="M10 6v5M10 14v.01"/>
          </svg>
          <%= message %>
        </p>
      <% end %>
    </div>
  <% end %>

  <div class="flex flex-col gap-2">
    <%= form.label :time_to_answer_seconds, class: "label" do %>
      Time to Answer (seconds)
    <% end %>
    <%= form.number_field :time_to_answer_seconds,
        min: Room::MIN_WAITING_TIME_SECONDS,
        max: Room::MAX_WAITING_TIME_SECONDS,
        class: "form-input"
    %>
    <span class="text-sm body italic">Between <%= Room::MIN_WAITING_TIME_SECONDS %> and <%= Room::MAX_WAITING_TIME_SECONDS %> seconds</span>
  </div>

  <div class="flex flex-col gap-2">
    <%= form.label :time_to_vote_seconds, class: "label" do %>
      Time to Vote (seconds)
    <% end %>
    <%= form.number_field :time_to_vote_seconds,
        min: Room::MIN_WAITING_TIME_SECONDS,
        max: Room::MAX_WAITING_TIME_SECONDS,
        class: "form-input"
    %>
    <span class="text-sm body italic">Between <%= Room::MIN_WAITING_TIME_SECONDS %> and <%= Room::MAX_WAITING_TIME_SECONDS %> seconds</span>
  </div>

  <div class="flex gap-4 mt-4 flex-col sm:flex-row">
    <%= form.submit "Save Settings",
        class: "btn-primary flex-1",
        data: { settings_modal_target: "submitButton" } %>
    <button type="button"
            class="btn-secondary flex-1"
            data-action="click->settings-modal#close">
      Cancel
    </button>
  </div>

  <% if form_saved %>
    <div class="animate-slide-up">
      <p class="text-success font-medium animate-bounce-custom">Settings updated successfully</p>
    </div>
  <% end %>
<% end %>
