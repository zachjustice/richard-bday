<!-- app/views/blanks/_form.html.erb -->
<% edit_mode = blank.persisted? %>

<%= form_with model: blank,
    id: "blank-modal-form",
    url: edit_mode ? story_blank_path(story, blank) : story_blanks_path(story),
    method: edit_mode ? :patch : :post,
    data: {
      controller: "blank-form",
      blank_form_story_id_value: story.id,
      blank_form_blank_id_value: blank.id,
      blank_form_edit_mode_value: edit_mode,
      blank_form_existing_prompt_ids_value: blank.prompts.pluck(:id).to_json
    } do |form| %>

  <%= render "blanks/form_errors", blank: blank %>

  <!-- Tags Input -->
  <div class="form-field">
    <%= form.label :tags, "Tags (comma-separated)" %>
    <%= form.text_field :tags,
        placeholder: "noun,animal,funny",
        class: "form-input",
        data: {
          action: "input->blank-form#filterPrompts",
          blank_form_target: "tagsInput"
        } %>
    <p class="form-hint">Tags help match prompts. Use commas to separate.</p>
  </div>

  <!-- Existing Prompts Selection -->
  <div class="form-section" data-blank-form-target="promptsSection">
    <h4 class="form-section-title">
      Select Existing Prompts
      <span class="prompt-count" data-blank-form-target="promptCount">(0 matching)</span>
    </h4>

    <div class="prompts-checklist" data-blank-form-target="promptsList">
      <p class="text-secondary">Enter tags above to see matching prompts</p>
    </div>
  </div>

  <!-- New Prompts Creation -->
  <div class="form-section">
    <h4 class="form-section-title">Or Create New Prompts</h4>
    <p class="form-hint">New prompts will inherit the blank's tags</p>

    <div class="new-prompts-list" data-blank-form-target="newPromptsList">
      <!-- Dynamic prompt fields added here -->
    </div>

    <button type="button"
            class="btn-secondary btn-sm"
            data-action="click->blank-form#addNewPromptField">
      + Add New Prompt
    </button>
  </div>

  <!-- Validation Message -->
  <div class="form-validation-hint" data-blank-form-target="validationHint">
    You must select at least one existing prompt or create a new one.
  </div>

  <div class="form-actions">
    <%= form.submit edit_mode ? "Update Blank" : "Create Blank",
        class: "btn-primary btn-sm",
        data: { blank_form_target: "submitButton" } %>
  </div>
<% end %>