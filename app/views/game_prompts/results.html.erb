<%= turbo_stream_from "rooms:#{@current_room.id}:nav-updates" %>
<%= render "shared/leave_game_button" unless discord_authenticated? %>
<div id="results" data-controller="navigation-check" data-navigation-check-room-id-value="<%= @current_room.id %>" class="<%= discord_authenticated? ? 'flex flex-col items-center max-sm:items-start justify-center bg-page' : 'min-h-screen flex items-center max-sm:items-start justify-center bg-page pt-16' %>">
  <div class="card-primary animate-fade-in relative z-content <%= discord_authenticated? ? 'm-4 p-8 max-sm:p-6' : 'm-4 p-12 max-sm:p-8' %> max-w-xl w-full max-h-[90vh] overflow-hidden">
    <%= render "shared/round_badge" if discord_authenticated? %>
    <% if @status == RoomStatus::FinalResults %>
      <div class="text-center">
        <span class="text-5xl max-sm:text-4xl mb-4 block animate-bounce-custom">ğŸ‰</span>
        <h2 class="text-3xl max-sm:text-2xl font-bold text-gray-900 mb-3 leading-tight">Game Complete!</h2>
        <% if @current_user.role == User::NAVIGATOR %>
          <p class="text-base max-sm:text-sm text-gray-500 italic mb-8">Click 'Start New Game' when you're ready!</p>
          <%= form_with url: "/rooms/#{@current_room.id}/end_game", method: :post, class: "flex justify-center" do |form| %>
            <%= form.submit "Start New Game", class: "btn-primary min-w-[200px]" %>
          <% end %>
        <% else %>
          <p class="text-base max-sm:text-sm text-gray-500 italic">Check the big screen for the final results!</p>
        <% end %>
      </div>
    <% elsif @status == RoomStatus::WaitingRoom %>
      <div class="text-center">
        <span class="text-5xl max-sm:text-4xl mb-4 block animate-swing">â³</span>
        <h2 class="text-3xl max-sm:text-2xl font-bold text-gray-900 mb-3 leading-tight">Between Games</h2>
        <p class="text-base max-sm:text-sm text-gray-500 italic mb-8">Waiting for a new game to start...</p>
        <%= render "shared/fun_facts" %>
      </div>
    <% elsif @status != RoomStatus::Results %>
      <div class="text-center">
        <span class="text-5xl max-sm:text-4xl mb-4 block animate-swing">â³</span>
        <h2 class="text-3xl max-sm:text-2xl font-bold text-gray-900 mb-3 leading-tight">Counting Votes</h2>
        <p class="text-base max-sm:text-sm text-gray-500 italic mb-8">Waiting for everyone to vote...</p>
        <%= render "shared/fun_facts" %>
      </div>
    <% else %>
      <% if discord_authenticated? %>
        <%= render "game_prompts/discord_results" %>
      <% else %>
        <div class="text-center">
          <span class="text-5xl max-sm:text-4xl mb-4 block animate-bounce-custom">ğŸ†</span>
          <h2 class="text-3xl max-sm:text-2xl font-bold text-gray-900 mb-3 leading-tight">Round Complete!</h2>
          <p class="text-base max-sm:text-sm text-gray-500 italic mb-8">Check the big screen for the winner.</p>
        </div>
        <% if @current_user.role == User::NAVIGATOR %>
          <%= form_with url: "/rooms/#{@current_room.id}/next", method: :post, class: "flex justify-center" do |form| %>
            <%= form.submit "Next Round", class: "btn-primary min-w-[200px]" %>
          <% end %>
        <% else %>
          <div class="progress-dots">
            <span class="progress-dot"></span>
            <span class="progress-dot"></span>
            <span class="progress-dot"></span>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
  <% if discord_authenticated? && @status != RoomStatus::Results && @status != RoomStatus::FinalResults && @status != RoomStatus::WaitingRoom %>
    <% voted = User.players.where(room: @current_room, status: UserStatus::Voted).count %>
    <% total = User.players.where(room: @current_room).count %>
    <%= render "shared/players_done_counter", done_count: voted, total_count: total %>
  <% end %>
</div>
