#!/bin/bash

# Get list of staged Ruby files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(rb|rake)$')

if [ -z "$STAGED_FILES" ]; then
  exit 0
fi

echo "Running Rubocop on staged files..."

# Run rubocop with auto-fix on staged files
bundle exec rubocop -a $STAGED_FILES

RUBOCOP_EXIT=$?

if [ $RUBOCOP_EXIT -ne 0 ]; then
  echo "Rubocop found issues that couldn't be auto-fixed. Please fix them manually."
  exit 1
fi

# Re-add the files that were auto-fixed
git add $STAGED_FILES

exit 0
